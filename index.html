<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DmWin Smart Assistant ‚Äì Color Only</title>

<style>
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:linear-gradient(180deg,#050b1f,#0b1535);
  color:#e8ecff;
}
.container{
  max-width:420px;
  margin:20px auto;
  padding:16px;
}
.card{
  background:#0e1a3a;
  border:1px solid #1f3b8f;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
h1{margin:0 0 6px;font-size:20px}
.small{opacity:.7;font-size:13px}
.green{color:#2ecc71}
.red{color:#ff4d4d}
.violet{color:#c77dff}
.wait{color:#f1c40f}
.center{text-align:center}
button{
  background:#142b6f;
  border:1px solid #2f55d4;
  color:#fff;
  padding:10px 14px;
  border-radius:10px;
  cursor:pointer;
}
button.danger{
  background:#5a1a1a;
  border-color:#ff4d4d;
}
.flex{
  display:flex;
  gap:10px;
  justify-content:center;
}
</style>
</head>

<body>
<div class="container">

<h1>üß† DmWin Smart Assistant</h1>
<div class="small">Education / analysis only</div>

<div class="card">
  üü¢ <b>Status:</b> LIVE<br>
  ‚è± <span id="timer">--</span> seconds remaining
</div>

<div class="card" id="predictionBox">Loading‚Ä¶</div>

<div class="card" id="resultBox">Waiting for result‚Ä¶</div>

<div class="card" id="statsBox">
üìä Wins: 0 | ‚ùå Losses: 0 | üéØ Accuracy: 0%
</div>

<div class="flex">
  <button onclick="resetStats()">üìä Reset Stats</button>
  <button class="danger" onclick="resetHardStop()">üõë Reset Hard Stop</button>
</div>

<div class="card">
üìú <b>Latest Results</b>
<div id="history"></div>
</div>

<div class="small center">
‚ö†Ô∏è No guarantees ‚Ä¢ Avoid over-betting ‚Ä¢ Stay disciplined
</div>

</div>

<script>
const API =
"https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json?pageNo=1&pageSize=10";

/* ================= STATE ================= */
let state = JSON.parse(localStorage.getItem("dmwin_color_state")) || {
  wins:0,
  losses:0,
  lastBet:null,
  lastEvaluatedIssue:null,
  lossStreak:0,
  hardStop:false,
  lockedIssue:null,
  lockedPrediction:null,
  lockedConfidence:null
};

function save(){
  localStorage.setItem("dmwin_color_state",JSON.stringify(state));
}

/* ================= HELPERS ================= */
function colorOf(n){
  n = Number(n);
  if(n===0) return ["red","violet"];
  if(n===5) return ["green","violet"];
  return n%2===0 ? ["red"] : ["green"];
}

/* ================= AI CORE ================= */
function analyze(list){
  if(state.hardStop) return {action:"WAIT",reason:"Hard stop active"};

  const last6=list.slice(0,6);
  let green=0, red=0, violet=0;

  last6.forEach(i=>{
    const c=colorOf(i.number);
    if(c.includes("green")) green++;
    if(c.includes("red")) red++;
    if(c.includes("violet")) violet++;
  });

  if(violet>=2) return {action:"WAIT",reason:"High violet risk"};

  if(state.lossStreak>=3){
    state.hardStop=true;
    save();
    return {action:"WAIT",reason:"Hard stop (3 losses)"};
  }

  let pick = green>red ? "GREEN" : "RED";
  let confidence = Math.round((Math.max(green,red)/6)*100);

  if(state.lossStreak===1) confidence-=10;
  if(state.lossStreak===2) confidence-=20;

  if(confidence<45) return {action:"WAIT",reason:"Low confidence"};

  return {action:pick,confidence};
}

/* ================= MAIN LOOP ================= */
async function tick(){
  const res=await fetch(API);
  const json=await res.json();
  const list=json.data.list;

  const currentIssue=list[0].issueNumber;
  const latestColors=colorOf(list[0].number);

  /* === RESULT CHECK (ONCE PER ISSUE) === */
  if(state.lastBet && state.lastEvaluatedIssue!==currentIssue){
    if(latestColors.includes(state.lastBet)){
      state.wins++;
      state.lossStreak=0;
      resultBox.innerHTML="‚úÖ Last Bet: <span class='green'>WIN</span>";
    }else{
      state.losses++;
      state.lossStreak++;
      resultBox.innerHTML="‚ùå Last Bet: <span class='red'>LOSS</span>";
    }
    state.lastBet=null;
    state.lastEvaluatedIssue=currentIssue;
    save();
  }

  /* === LOCKED PREDICTION === */
  if(state.lockedIssue !== currentIssue){
    const d = analyze(list);
    state.lockedIssue = currentIssue;

    if(d.action==="WAIT"){
      state.lockedPrediction="WAIT";
      state.lockedConfidence=null;
    }else{
      state.lockedPrediction=d.action.toLowerCase();
      state.lockedConfidence=d.confidence;
      state.lastBet=d.action.toLowerCase();
    }
    save();
  }

  /* === DISPLAY PREDICTION === */
  if(state.lockedPrediction==="WAIT"){
    predictionBox.innerHTML=
      "‚è∏ <b>Prediction:</b> <span class='wait'>WAIT</span><br>"+
      "<span class='small'>Prediction locked for period "+state.lockedIssue+"</span>";
  }else{
    predictionBox.innerHTML=
      "üéØ <b>Prediction:</b> <span class='"+state.lockedPrediction+"'>"+
      state.lockedPrediction.toUpperCase()+"</span><br>"+
      "<span class='small'>Confidence: "+state.lockedConfidence+
      "% ‚Ä¢ Locked for period "+state.lockedIssue+"</span>";
  }

  /* === STATS === */
  const total=state.wins+state.losses;
  const acc=total?Math.round((state.wins/total)*100):0;
  statsBox.innerText=
    `üìä Wins: ${state.wins} | ‚ùå Losses: ${state.losses} | üéØ Accuracy: ${acc}%`;

  /* === HISTORY (FIXED) === */
  history.innerHTML=list.slice(0,5).map(i=>{
    const parts=colorOf(i.number);
    return `<div>${i.issueNumber} ‚Üí ${
      parts.map(p=>`<span class="${p}">${p}</span>`).join(" + ")
    }</div>`;
  }).join("");
}

/* ================= TIMER ================= */
setInterval(()=>{
  document.getElementById("timer").innerText = 60 - new Date().getSeconds();
},500);

/* ================= CONTROLS ================= */
function resetStats(){
  state.wins=0;
  state.losses=0;
  state.lossStreak=0;
  state.lastBet=null;
  state.lastEvaluatedIssue=null;
  save();
  location.reload();
}

function resetHardStop(){
  state.lossStreak=0;
  state.hardStop=false;
  save();
  alert("Hard stop reset");
}

/* ================= START ================= */
tick();
setInterval(tick,60000);
</script>

</body>
</html>
