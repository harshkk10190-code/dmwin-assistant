<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kira BKL Smart Assistant â€“ Color Only</title>

<style>
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:linear-gradient(180deg,#050b1f,#0b1535);
  color:#e8ecff;
}
.container{
  max-width:420px;
  margin:20px auto;
  padding:16px;
}
.card{
  background:#0e1a3a;
  border:1px solid #1f3b8f;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
h1{margin:0 0 6px;font-size:20px}
.small{opacity:.7;font-size:13px}
.green{color:#2ecc71}
.red{color:#ff4d4d}
.violet{color:#c77dff}
.wait{color:#f1c40f}
.center{text-align:center}
</style>
</head>

<body>
<div class="container">

<h1>ğŸ§  DmWin Smart Assistant</h1>
<div class="small">Education / analysis only</div>

<div class="card">
  ğŸŸ¢ <b>Status:</b> LIVE<br>
  â± <span id="timer">--</span> seconds remaining
</div>

<div class="card" id="predictionBox">Loadingâ€¦</div>

<div class="card" id="resultBox">Waiting for resultâ€¦</div>

<div class="card" id="statsBox">
  ğŸ“Š Wins: 0 | âŒ Losses: 0 | ğŸ¯ Accuracy: 0%
</div>

<div class="card">
  ğŸ“œ <b>Latest Results</b>
  <div id="history"></div>
</div>

<div class="small center">
âš ï¸ No guarantees â€¢ Avoid over-betting â€¢ Stay disciplined
</div>

</div>

<script>
const API =
"https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json?pageNo=1&pageSize=10";

/* ===== STATE (refresh-safe) ===== */
let state = JSON.parse(localStorage.getItem("dmwin_color_state")) || {
  wins:0,
  losses:0,
  lastBet:null,
  lastBetPeriod:null,
  lastSettledPeriod:null,
  lossStreak:0
};

function saveState(){
  localStorage.setItem("dmwin_color_state",JSON.stringify(state));
}

/* ===== COLOR LOGIC (CORRECT) ===== */
function colorOf(n){
  n = Number(n);
  if(n === 0) return "red,violet";
  if(n === 5) return "green,violet";
  return n % 2 === 0 ? "red" : "green";
}

/* ===== ANALYSIS (NOT OVER-WAIT) ===== */
function analyze(list){
  const last6 = list.slice(0,6).map(i=>colorOf(i.number));

  const green = last6.filter(c=>c.includes("green")).length;
  const red   = last6.filter(c=>c.includes("red")).length;
  const violet = last6.filter(c=>c.includes("violet")).length;

  if(violet >= 3) return {action:"WAIT", reason:"High violet risk"};

  if(state.lossStreak >= 2)
    return {action:"WAIT", reason:"Cooldown after losses"};

  let pick = green > red ? "GREEN" : "RED";
  let confidence = Math.round((Math.max(green,red)/6)*100);

  if(Math.abs(green-red) <= 1)
    return {action:"WAIT", reason:"No clear bias"};

  return {action:pick, confidence};
}

/* ===== MAIN LOOP ===== */
async function tick(){
  const res = await fetch(API);
  const json = await res.json();
  const list = json.data.list;

  const latestPeriod = list[0].issueNumber;
  const latestColor = colorOf(list[0].number);

  /* ===== SETTLE RESULT (ONCE ONLY) ===== */
  if(
    state.lastBet &&
    state.lastBetPeriod &&
    state.lastSettledPeriod !== latestPeriod
  ){
    if(latestColor.includes(state.lastBet)){
      state.wins++;
      state.lossStreak = 0;
      document.getElementById("resultBox").innerHTML =
        "âœ… Last Bet: <span class='green'>WIN</span>";
    }else{
      state.losses++;
      state.lossStreak++;
      document.getElementById("resultBox").innerHTML =
        "âŒ Last Bet: <span class='red'>LOSS</span>";
    }

    state.lastSettledPeriod = latestPeriod;
    state.lastBet = null;
    state.lastBetPeriod = null;
    saveState();
  }

  /* ===== PREDICTION ===== */
  const decision = analyze(list);
  const box = document.getElementById("predictionBox");

  if(decision.action === "WAIT"){
    box.innerHTML =
      "â¸ <b>Prediction:</b> <span class='wait'>WAIT</span><br>" +
      "<span class='small'>"+decision.reason+"</span>";
  }else{
    box.innerHTML =
      "ğŸ¯ <b>Prediction:</b> <span class='"+decision.action.toLowerCase()+"'>" +
      decision.action+"</span><br>" +
      "<span class='small'>Confidence: "+decision.confidence+"%</span>";

    state.lastBet = decision.action.toLowerCase();
    state.lastBetPeriod = latestPeriod;
    saveState();
  }

  /* ===== STATS ===== */
  const total = state.wins + state.losses;
  const acc = total ? Math.round((state.wins/total)*100) : 0;
  document.getElementById("statsBox").innerText =
    `ğŸ“Š Wins: ${state.wins} | âŒ Losses: ${state.losses} | ğŸ¯ Accuracy: ${acc}%`;

  /* ===== HISTORY ===== */
  document.getElementById("history").innerHTML =
    list.slice(0,5).map(i=>{
      const c = colorOf(i.number);
      const cls = c.includes("green") ? "green" :
                  c.includes("red") ? "red" : "violet";
      return `<div class="${cls}">${i.issueNumber} â†’ ${c}</div>`;
    }).join("");
}

/* ===== REAL TIMER ===== */
setInterval(()=>{
  document.getElementById("timer").innerText =
    60 - new Date().getSeconds();
},500);

tick();
setInterval(tick,60000);
</script>

</body>
</html>
